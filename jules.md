# 项目概要：魔塔 (Project Tower)

## 1. 项目目标

开发一款基于 Pixi.js 和 TypeScript 的网页版魔塔类游戏。游戏核心玩法是玩家在俯视视角的迷宫中探索，通过策略性地击败怪物、收集道具和钥匙来不断挑战更高层。游戏为竖屏手机端设计，无随机性，强调资源管理的策略规划。

## 2. 核心设计原则

- **逻辑与渲染彻底分离**: 游戏核心逻辑（状态管理、战斗计算、道具效果）必须独立于渲染引擎。逻辑层不应包含任何 Pixi.js 或 DOM 的引用，以便未来能轻松迁移到客户端-服务器架构。
- **模块化**: 代码按功能划分为独立的模块/包（例如：`core-logic`, `renderer`, `data-management`）。单个文件不应过大，保持高内聚、低耦合。
- **数据驱动**: 所有游戏数据（怪物属性、道具效果、地图布局）均由外部 JSON 文件定义，方便策划调整数值和关卡设计。
- **确定性**: 游戏不包含任何随机因素。玩家以相同的顺序执行相同的操作，必须产生完全相同的结果。
- **可测试性**: 核心逻辑部分必须有高覆盖率的单元测试（目标 > 90%），以保证游戏规则的正确性和稳定性。
- **完整的类型定义**: 所有代码必须使用 TypeScript，并提供完整的类型定义，以增强代码的可维护性和健壮性。
- **详尽的注释**: 为关键函数、类和复杂的逻辑块编写清晰的 JSDoc 注释。

## 3. 技术栈

- **渲染引擎**: Pixi.js (最新版)
- **开发语言**: TypeScript
- **构建/打包工具**: Vite (推荐，启动快，支持 TS)
- **测试框架**: Vitest 或 Jest
- **代码规范**: ESLint + Prettier

## 4. 目录结构

```
.
├── assets/              # 游戏资源 (图片)
│   ├── item/
│   ├── map/
│   └── monster/
├── gamedata/            # 游戏数据配置 (JSON)
│   ├── buffs/           # 增益效果配置
│   ├── equipments/      # 装备配置
│   ├── items/           # 道具配置
│   └── monsters/        # 怪物配置
├── jules/               # Jules 的开发计划文件
│   ├── plan001.md
│   └── ...
├── mapdata/             # 地图数据 (JSON)
│   └── floor_01.json
├── public/              # 静态文件
├── src/                 # 源码
│   ├── core/            # 核心逻辑 (无渲染)
│   │   ├── state.ts     # 状态管理
│   │   ├── types.ts     # 核心类型定义
│   │   ├── logic.ts     # 战斗、道具等逻辑
│   │   └── tests/       # 单元测试
│   ├── data/            # 数据加载和管理
│   │   └── data-manager.ts
│   ├── renderer/        # 渲染层 (Pixi.js)
│   │   ├── renderer.ts
│   │   └── ui/          # UI 组件
│   ├── scenes/          # 游戏场景/屏幕
│   │   ├── start-scene.ts
│   │   └── game-scene.ts
│   ├── main.ts          # 应用入口
│   └── types.ts         # 全局或共享类型
├── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

## 5. 数据格式约定

- **配置数据 (`gamedata/`)**: 使用 JSON 格式。每个对象（怪物、道具、装备、Buff）都有一个唯一的字符串 `id`。
  - `monsters`: 定义怪物的基础属性。
  - `items`: 定义可消耗或可使用的道具。
  - `equipments`: 定义可穿戴的装备及其属性加成。
  - `buffs`: 定义可应用于角色的增益或减益效果。
- **地图数据 (`mapdata/`)**: 使用 JSON 格式。包含 `layout` (二维数组定义基本地形) 和 `entities` (对象列表定义怪物、道具等实体的位置和ID)。
- **存档数据**: 使用 JSON 格式。记录游戏初始状态和玩家采取的每一步操作（Action）列表，以实现精确回放和状态恢复。

## 6. 开发流程

我们将遵循 `jules/` 目录下的计划文件，分阶段进行开发。从项目搭建、核心逻辑、数据加载，到渲染、UI、存档等功能，逐步完成。每个阶段都将包含充分的测试。

## 7. 当前开发状态

项目目前处于早期开发阶段。核心的数据结构和部分逻辑功能已经根据开发计划逐步建立。根据最新需求，我们已将 `plan011` 从设计文档升级为详细的可执行任务，用于实现核心的UI布局和分辨率适配。相关的UI计划（`plan006`, `plan008`）也已同步更新，以确保设计一致性。

- **已完成**:
    - **`plan001`, `plan002`**: 项目基础结构搭建完成。
    - **`plan010`**: 核心的 **装备与增益效果系统** 已完成，并通过单元测试验证。
    - **`plan003`**: **数据加载与状态生成** 已完成。实现了动态数据加载机制，并能根据地图数据生成初始游戏状态。
    - **`plan004`**: **基础渲染引擎** 已完成。搭建了基础的渲染框架，能将游戏状态（地图、角色）可视化。
    - **`plan005`**: **玩家输入与主游戏循环** 已完成。实现了完整的“输入->逻辑->渲染”循环，玩家现在可以控制角色移动。
    - **`plan011`**: **游戏界面与分辨率适配实现**。完成了核心的UI框架、分辨率缩放、16x16地图适配和渲染层重构。
    - **`plan006`**: **HUD 与 UI 界面**。实现了功能完整的平视显示器（HUD），用于展示玩家的详细状态。

- **下一个任务建议**:
    - **`plan007`**: **存档与读档系统**。现在游戏的核心玩法和UI已经初步成型，实现存档和读档功能对于提升玩家体验至关重要。

- **未开始**:
    - **`plan008`**: 屏幕管理与菜单界面 (依赖 `plan011`)
    - **`plan009`**: 特殊道具、收尾与润色

整体开发将按照上述计划顺序，在完成 `plan005` 的核心交互后，继续推进UI、存档等模块的开发。
