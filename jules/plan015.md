1. *更新核心数据结构*：
   - 为角色（玩家、怪物）添加 `speed` 基础属性。
   - 扩展装备（Equipment）对象，使其能定义固定值 (`stat_mods`) 和百分比 (`percent_mods`) 的属性变更。百分比将基于角色的基础属性计算。

2. *实现核心游戏机制*：
   - 创建一个全局属性计算服务，该服务接收一个角色对象，并根据其基础属性和装备计算出最终战斗属性。此服务将强制执行“属性值不得低于1”的规则。
   - 修改战斗系统，根据角色的最终 `speed` 属性来决定攻击顺序。
   - 移除已废弃的“先手 buff”相关代码。

3. *实现装备更换与比较逻辑*：
   - 开发一个名为 `handleNewEquipment` 的函数，作为处理新装备获取的入口点。
   - 在此函数中实现完整的决策树：
     - **空槽位**：直接装备。
     - **已占用槽位**：计算新旧装备的属性差异。
       - **纯提升**：自动更换，旧装备进入库存。
       - **纯降低**：丢弃新装备。
       - **混合变化**：弹出UI对话框供玩家选择。
     - **1H/2H 特殊情况**：强制弹出UI对话框。
   - 我将创建模拟的UI调用函数，以便测试验证。

4. *简化库存管理*：
   - 取消复杂的备用武器自动比较流程。
   - 当装备被替换时，旧装备将被简单地移入玩家的通用库存中，玩家可以后续手动管理。

5. *编写全面的测试用例*：
   - 为属性计算逻辑编写单元测试（覆盖固定值、百分比和下限规则）。
   - 为战斗顺序逻辑编写集成测试。
   - 为 `handleNewEquipment` 函数的所有分支（纯提升、纯降低、混合变化、1H/2H）编写详细的单元测试。

6. *完成文档和报告*：
   - 创建 `jules/plan015.md` 来记录此计划。
   - 任务完成后，撰写 `jules/plan015-report.md`。
   - 更新主 `jules.md` 文档，详细说明新的装备系统规则，并更新开发状态。
   - 审查并酌情更新 `agents.md`。
