# 计划 009: 特殊道具、收尾与润色

## 目标

实现所有剩余的特殊游戏功能，并对整个项目进行全面的测试、优化和润色，确保游戏的完整性和高质量。

## 主要任务

1.  **实现特殊道具逻辑**:
    - 在 `src/core/logic.ts` 中，为 `PICK_UP_ITEM` action 扩展逻辑，以处理特殊道具：
    - **魔法炸弹**: 拾取后，可以作为一次性消耗品使用。使用后，摧毁当前楼层所有特定类型的怪物（例如，所有史莱姆）。需要添加一个新的 `USE_BOMB` Action。
    - **怪物手册**: 拾取后，玩家可以在任何时候查看怪物的属性（永久解锁怪物信息面板功能）。
    - **雪花**: 拾取后，玩家在接下来的战斗中可以先手攻击两次（或者其他特殊效果）。需要修改战斗逻辑以检查玩家是否持有此 buff。
    - **十字架**: 拾取后，可能提供一次性的属性大幅提升，或对特定类型的敌人（如恶魔系）有特效。

2.  **实现特殊门**:
    - **蓝色门 (事件门)**:
        - 在地图数据中，为蓝色门添加一个 `condition` 字段，例如 `{ type: 'DEFEAT_BOSS', monsterId: 55 }`。
        - 在 `GameStateManager` 中，每当有怪物被击败时，检查是否有门的开启条件被满足。如果满足，则自动将对应的门从地图上移除。

3.  **视觉与音效润色**:
    - **视觉效果 (VFX)**:
        - 为战斗添加简单的视觉反馈，例如数字跳动（表示伤害或恢复）、屏幕轻微震动、角色闪烁等。
        - 为拾取道具、开门等互动添加简单的动画或粒子效果。
    - **音效 (SFX)**:
        - 集成一个简单的音频库（如 `howler.js`）。
        - 为关键操作添加音效：攻击、受伤、拾取道具、开门、点击按钮等。
        - 添加背景音乐（BGM），并可以在不同场景切换。

4.  **最终测试与审查**:
    - **完整流程测试**: 从头开始玩游戏，确保所有楼层、道具、怪物和事件都按预期工作。
    - **代码审查**:
        - 检查所有代码是否遵循了项目初期定下的规范（模块化、注释、类型定义）。
        - 确保逻辑和渲染的分离原则没有被破坏。
        - 移除所有临时的测试代码和 `console.log`。
    - **性能检查**: 在低端设备上测试，确保游戏运行流畅。
    - **兼容性测试**: 在主流的手机浏览器上进行测试。

5.  **构建与部署准备**:
    - 运行 `npm run build` (或 `yarn build`)，确保项目能够成功打包成静态文件。
    - 检查 `dist/` 目录下的产物是否完整，可以直接部署到任何静态网站托管服务。

## 验收标准

- 所有特殊道具（炸弹、手册、雪花、十字架）的功能都已实现并符合设计。
- 蓝色事件门能够在满足条件（如击败特定怪物）后自动打开。
- 游戏有恰当的视觉和音效反馈，提升了玩家体验。
- 游戏经过完整测试，没有发现重大的逻辑 bug 或视觉缺陷。
- 代码库整洁、注释清晰、结构合理。
- 项目可以成功构建，并准备好进行最终部署。
